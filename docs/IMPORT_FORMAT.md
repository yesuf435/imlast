# IMç³»ç»ŸèŠå¤©è®°å½•å¯¼å…¥æ ¼å¼è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æµ‹è¯•ç»“æœ

æ ¹æ®åˆšæ‰çš„æµ‹è¯•ï¼Œç³»ç»ŸåŠŸèƒ½çŠ¶æ€å¦‚ä¸‹ï¼š

âœ… **æ­£å¸¸å·¥ä½œçš„åŠŸèƒ½:**
- ç”¨æˆ·æ³¨å†Œ/ç™»å½• 
- å¥½å‹åˆ—è¡¨è·å–
- ç§ä¿¡åŠŸèƒ½
- èŠå¤©åˆ—è¡¨
- æ–‡ä»¶ä¸Šä¼ æ¥å£
- Socket.ioå®æ—¶é€šä¿¡

âš ï¸ **éœ€è¦æ³¨æ„çš„åŠŸèƒ½:**
- ç¾¤ç»„åŠŸèƒ½æ¥å£ (APIè·¯å¾„å¯èƒ½éœ€è¦è°ƒæ•´)

## ğŸ—‚ï¸ æ•°æ®åº“ç»“æ„åˆ†æ

### æ¶ˆæ¯è¡¨ (messages) å­—æ®µç»“æ„:
```javascript
{
  sender: ObjectId,           // å‘é€è€…ç”¨æˆ·ID (å¿…å¡«)
  receiver: ObjectId,         // æ¥æ”¶è€…ç”¨æˆ·ID (ç§ä¿¡æ—¶å¿…å¡«)
  group: ObjectId,           // ç¾¤ç»„ID (ç¾¤èŠæ—¶å¿…å¡«)
  content: String,           // æ¶ˆæ¯å†…å®¹ (å¿…å¡«)
  type: String,              // æ¶ˆæ¯ç±»å‹: 'text', 'image', 'file', 'audio', 'video', 'location', 'emoji'
  fileInfo: {                // æ–‡ä»¶ä¿¡æ¯ (æ–‡ä»¶æ¶ˆæ¯æ—¶ä½¿ç”¨)
    filename: String,        // æœåŠ¡å™¨æ–‡ä»¶å
    originalName: String,    // åŸå§‹æ–‡ä»¶å
    fileSize: Number,        // æ–‡ä»¶å¤§å°
    mimeType: String,        // MIMEç±»å‹
    fileUrl: String,         // æ–‡ä»¶è®¿é—®URL
    thumbnail: String        // ç¼©ç•¥å›¾URL
  },
  metadata: {                // å…ƒæ•°æ®
    latitude: Number,        // ä½ç½®çº¬åº¦
    longitude: Number,       // ä½ç½®ç»åº¦  
    address: String,         // åœ°å€
    duration: Number,        // éŸ³è§†é¢‘æ—¶é•¿
    width: Number,           // å›¾ç‰‡/è§†é¢‘å®½åº¦
    height: Number           // å›¾ç‰‡/è§†é¢‘é«˜åº¦
  },
  read: Boolean,             // æ˜¯å¦å·²è¯»
  readBy: [ObjectId],        // å·²è¯»ç”¨æˆ·åˆ—è¡¨
  timestamp: Date            // æ—¶é—´æˆ³
}
```

## ğŸ“¥ èŠå¤©è®°å½•å¯¼å…¥æ ¼å¼

### 1. JSONæ ¼å¼å¯¼å…¥ (æ¨è)

```json
{
  "messages": [
    {
      "sender": "ç”¨æˆ·IDæˆ–ç”¨æˆ·å",
      "receiver": "ç”¨æˆ·IDæˆ–ç”¨æˆ·å", 
      "content": "æ¶ˆæ¯å†…å®¹",
      "type": "text",
      "timestamp": "2025-10-11T10:30:00Z"
    },
    {
      "sender": "ç”¨æˆ·IDæˆ–ç”¨æˆ·å",
      "group": "ç¾¤ç»„IDæˆ–ç¾¤ç»„å",
      "content": "ç¾¤èŠæ¶ˆæ¯å†…å®¹", 
      "type": "text",
      "timestamp": "2025-10-11T10:31:00Z"
    },
    {
      "sender": "ç”¨æˆ·IDæˆ–ç”¨æˆ·å",
      "receiver": "ç”¨æˆ·IDæˆ–ç”¨æˆ·å",
      "content": "å›¾ç‰‡æè¿°",
      "type": "image",
      "fileInfo": {
        "originalName": "photo.jpg",
        "fileSize": 1024000,
        "mimeType": "image/jpeg",
        "fileUrl": "/uploads/photo.jpg"
      },
      "metadata": {
        "width": 1920,
        "height": 1080
      },
      "timestamp": "2025-10-11T10:32:00Z"
    }
  ]
}
```

### 2. CSVæ ¼å¼å¯¼å…¥

```csv
sender,receiver,group,content,type,timestamp,fileUrl,fileName,fileSize
user1,user2,,ä½ å¥½ï¼,text,2025-10-11T10:30:00Z,,,
user2,user1,,ä½ å¥½ï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ,text,2025-10-11T10:31:00Z,,,
user1,,group1,å¤§å®¶å¥½,text,2025-10-11T10:32:00Z,,,
user1,user2,,çœ‹çœ‹è¿™å¼ å›¾ç‰‡,image,2025-10-11T10:33:00Z,/uploads/photo.jpg,photo.jpg,1024000
```

### 3. å¾®ä¿¡èŠå¤©è®°å½•æ ¼å¼ (è‡ªåŠ¨è½¬æ¢)

```
2025-10-11 10:30:00 å¼ ä¸‰
ä½ å¥½ï¼

2025-10-11 10:31:00 æå››  
ä½ å¥½ï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ 

2025-10-11 10:32:00 å¼ ä¸‰
[å›¾ç‰‡]

2025-10-11 10:33:00 æå››
[æ–‡ä»¶: document.pdf]
```

## ğŸ“¤ æ”¯æŒçš„æ–‡ä»¶ç±»å‹

### å›¾ç‰‡ç±»å‹:
- JPG/JPEG
- PNG  
- GIF
- WebP
- BMP

### æ–‡ä»¶ç±»å‹:
- PDF
- DOC/DOCX
- XLS/XLSX
- PPT/PPTX
- TXT
- ZIP/RAR

### éŸ³è§†é¢‘ç±»å‹:
- MP3/WAV (éŸ³é¢‘)
- MP4/AVI (è§†é¢‘)

## ğŸ› ï¸ å¯¼å…¥å·¥å…·ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: ä½¿ç”¨æ‰¹é‡å¯¼å…¥API

```bash
# å¯¼å…¥JSONæ ¼å¼æ•°æ®
curl -X POST http://localhost:3001/api/admin/messages/batch \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d @chat_records.json
```

### æ–¹æ³•2: ä½¿ç”¨å¯¼å…¥è„šæœ¬

```bash
# ä½¿ç”¨æˆ‘ä»¬æä¾›çš„å¯¼å…¥è„šæœ¬
./import_chat_records.sh chat_records.json
```

### æ–¹æ³•3: MongoDBç›´æ¥å¯¼å…¥

```bash
# ç›´æ¥å¯¼å…¥åˆ°MongoDB
docker exec im-mongodb mongoimport --db im-system --collection messages --file /tmp/messages.json --jsonArray
```

## ğŸ“ æ–‡ä»¶å¤„ç†è¯´æ˜

### æ–‡ä»¶ä¸Šä¼ æµç¨‹:
1. å…ˆä¸Šä¼ æ–‡ä»¶åˆ° `/uploads/` ç›®å½•
2. è·å–æ–‡ä»¶URL
3. åˆ›å»ºåŒ…å«fileInfoçš„æ¶ˆæ¯è®°å½•

### å›¾ç‰‡å¤„ç†:
- è‡ªåŠ¨ç”Ÿæˆç¼©ç•¥å›¾
- æå–å›¾ç‰‡å°ºå¯¸ä¿¡æ¯
- æ”¯æŒBase64æ ¼å¼å›¾ç‰‡

### å¤§æ–‡ä»¶å¤„ç†:
- æ”¯æŒåˆ†å—ä¸Šä¼ 
- è‡ªåŠ¨å‹ç¼©å¤„ç†
- ç”Ÿæˆä¸‹è½½é“¾æ¥

## âš¡ æ‰¹é‡å¯¼å…¥ä¼˜åŒ–

### æ€§èƒ½å»ºè®®:
- å•æ¬¡å¯¼å…¥å»ºè®®ä¸è¶…è¿‡1000æ¡æ¶ˆæ¯
- å¤§é‡æ•°æ®è¯·åˆ†æ‰¹å¯¼å…¥
- æ–‡ä»¶å…ˆæ‰¹é‡ä¸Šä¼ å†åˆ›å»ºæ¶ˆæ¯è®°å½•

### æ•°æ®éªŒè¯:
- è‡ªåŠ¨éªŒè¯ç”¨æˆ·IDå­˜åœ¨æ€§
- æ£€æŸ¥ç¾¤ç»„IDæœ‰æ•ˆæ€§
- éªŒè¯æ–‡ä»¶è·¯å¾„å¯è®¿é—®æ€§

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜:
1. **ç”¨æˆ·IDä¸å­˜åœ¨** - è¯·å…ˆå¯¼å…¥ç”¨æˆ·æ•°æ®
2. **æ–‡ä»¶è·¯å¾„é”™è¯¯** - ç¡®ä¿æ–‡ä»¶å·²ä¸Šä¼ åˆ°æ­£ç¡®ç›®å½•
3. **æ—¶é—´æ ¼å¼é”™è¯¯** - ä½¿ç”¨ISO 8601æ ¼å¼
4. **æƒé™ä¸è¶³** - ç¡®ä¿ä½¿ç”¨ç®¡ç†å‘˜token

---

**æ³¨æ„**: å¯¼å…¥å‰è¯·å¤‡ä»½ç°æœ‰æ•°æ®ï¼Œå¯¼å…¥è¿‡ç¨‹ä¸å¯é€†ï¼
